# 지하철 노선도 미션
[ATDD 강의](https://edu.nextstep.camp/c/R89PYi5H) 실습을 위한 지하철 노선도 애플리케이션

# 인수 테스트와 TDD
## 0단계 - 단위 테스트 작성
### 요구사항
- 지하철 구간 관련 단위 테스트 작성
  - [x] 구간 단위 테스트
    - [x] 구간 테스트를 위한 지하철역 테스트
    - [x] 구간 테스트를 위한 노선 테스트
  - [x] 구간 서비스 단위 테스트 with Mock
  - [x] 구간 서비스 단위 테스트 without Mock
- 단위 테스트를 기반으로 비지니스 로직 리팩터링

## 1단계 - 구간 추가 요구사항 반영
### 사용자 스토리
>사용자로서<br>
>지하철 노선도를 조금 더 편리하기 관리하기 위해<br>
>위치에 상관없이 지하철 노선에 역을 추가 할 수 있다
### 요구사항
- 노선에 역 추가시 노선 가운데에 추가 할 수 있다.
- 노선에 역 추가시 노선 처음에 추가 할 수 있다.
- 이미 등록되어있는 역은 노선에 등록될 수 없다
### 인수테스트 시나리오
#### 노선에 역 추가시 노선 가운데에 추가
- 성공 시나리오
  > Given 지하철 노선을 생성하고<br>
  > When 해당 노선 가운데 구간에 새로운 구간을 추가하면<br>
  > Then 지하철 노선 조회시 가운데에 새로운 구간이 추가된 정보가 조회된다.
- 실패 시나리오
  > Given 지하철 노선을 생성하고<br>
  > When 해당 노선 가운데 구간에 새로운 구간을 추가하는데<br>
  > When 새로운 구간의 상행역, 하행역 모두 이미 노선에 등록되어 있다면<br>
  > Then 에러가 난다.

  > Given 지하철 노선을 생성하고<br>
  > When 해당 노선 가운데 구간에 새로운 구간을 추가하는데<br>
  > When 새로운 구간의 상행역, 하행역 모두 해당 노선에 포함되어 있지 않다면<br>
  > Then 에러가 난다.

  > Given 지하철 노선을 생성하고<br>
  > When 해당 노선 가운데 구간에 새로운 구간을 추가하는데<br>
  > When 새로운 구간의 길이가 기존 노선의 길이보다 같거나 길다면<br>
  > Then 에러가 난다.
#### 노선에 역 추가시 노선 처음에 추가
- 성공 시나리오
  > Given 지하철 노선을 생성하고<br>
  > When 해당 노선 첫 구간에 새로운 구간을 추가하면<br>
  > Then 지하철 노선 조회시 처음에 새로운 구간이 추가된 정보가 조회된다.
- 실패 시나리오
  > Given 지하철 노선을 생성하고<br>
  > When 해당 노선 첫 구간에 새로운 구간을 추가하는데<br>
  > When 새로운 구간의 상행역, 하행역 모두 이미 노선에 등록되어 있다면<br>
  > Then 에러가 난다.

  > Given 지하철 노선을 생성하고<br>
  > When 해당 노선 첫 구간에 새로운 구간을 추가하는데<br>
  > When 새로운 구간의 상행역, 하행역 모두 해당 노선에 포함되어 있지 않다면<br>
  > Then 에러가 난다.

## 2단계 - 구간 제거 요구사항 반영
### 사용자 스토리
>사용자로서<br>
>지하철 노선도를 조금 더 편리하기 관리하기 위해<br>
>위치에 상관없이 지하철 노선에 역을 제거 할 수 있다
### 요구사항
- 노선에 등록된 역 제거 시 해당 역이 노선 가운데 있어도 제거할 수 있다.
- 노선에 등록된 역 제거 시 해당 역이 상행 종점역이어도 제거할 수 있다.
### 인수테스트 시나리오
#### 가운데 역 제거
- 성공 시나리오
  > Given 지하철 노선을 생성하고<br>
  > Given 해당 노선 가운데에 구간을 추가하고<br>
  > When 해당 노선 가운데에 추가한 역을 제거하면<br>
  > Then 지하철 노선 조회시 가운데 역이 제거된 정보가 조회된다.
- 실패 시나리오
  > Given 지하철 노선을 생성하고<br>
  > When 구간이 1개이하인 노선의 역 제거 요청을 하면<br>
  > Then 에러가 난다.

  > Given 지하철 노선을 생성하고<br>
  > When 해당 노선에 존재하지 않는 역을 제거하면<br>
  > Then 에러가 난다.
#### 상행 종점역(첫번째) 역 제거
- 성공 시나리오
  > Given 지하철 노선을 생성하고<br>
  > Given 해당 노선 가운데에 구간을 추가하고<br>
  > When 해당 노선 첫번째 역을 제거하면<br>
  > Then 지하철 노선 조회시 첫번째 역이 제거된 정보가 조회된다.
- 실패 시나리오
  > Given 지하철 노선을 생성하고<br>
  > When 구간이 1개이하인 노선의 역 제거 요청을 하면<br>
  > Then 에러가 난다.

  > Given 지하철 노선을 생성하고<br>
  > When 해당 노선에 존재하지 않는 역을 제거하면<br>
  > Then 에러가 난다.


## 3단계 - 경로 조회 기능
### 요구사항
- 경로 조회 기능 구현
  - Request
  ```shell
    HTTP/1.1 200
    Request method:	GET
    Request URI:	http://localhost:55494/paths?source={출발역_id}&target={도착역_id}
    Headers: 	Accept=application/json
    Content-Type=application/json; charset=UTF-8
  ```
  - Response
  ```shell
  HTTP/1.1 200 
  Content-Type: application/json
  Transfer-Encoding: chunked
  Date: Sat, 09 May 2020 14:54:11 GMT
  Keep-Alive: timeout=60
  Connection: keep-alive
  
  {
    "stations": [
        {
          "id": 1,
          "name": "교대역"
        },
        {
          "id": 4,
          "name": "남부터미널역"
        },
        {
          "id": 3,
          "name": "양재역"
        }
      ],
    "distance": 5
  }
  ```
### 인수테스트 시나리오
#### 경로 조회 기능
- 성공 시나리오
  > Given <br>
  (교대역--5--강남역) - 2호선 <br>
  (강남역--10--양재역) - 신분당선 <br>
  (교대역--2--남부터미널역--3--양재역) - 3호선 <br>
  > 을 생성하고<br>
  > When 출발역(강남역)과 도착역(남부터미널)을 통해 경로를 조회하면<br>
  > Then 최단거리인 강남역, 교대역, 남부터미널역의 정보와 총 거리인 7가 반환된다.
- 실패 시나리오
  > Given <br>
  (교대역--5--강남역) - 2호선 <br>
  (강남역--10--양재역) - 신분당선 <br>
  (교대역--2--남부터미널역--3--양재역) - 3호선 <br>
  > 을 생성하고<br>
  > When 출발역과 도착역이 같은 역을 통해 경로를 조회하면<br>
  > Then 에러가 난다.

  > Given <br>
  (교대역--5--강남역) - 2호선 <br>
  (강남역--10--양재역) - 신분당선 <br>
  (교대역--2--남부터미널역--3--양재역) - 3호선 <br>
  > 을 생성하고<br>
  > When 존재하지 않는 출발역이나 도착역을 통해 경로를 조회하면<br>
  > Then 에러가 난다.

  > Given <br>
  (교대역--5--강남역) - 2호선 <br>
  (강남역--10--양재역) - 신분당선 <br>
  (교대역--2--남부터미널역--3--양재역) - 3호선 <br>
  (사당역--5--서울역) - 4호선 <br>
  > 을 생성하고<br>
  > When 연결되지 않은 출발역(교대역)과 도착역(서울역)을 통해 경로를 조회하면<br>
  > Then 에러가 난다.

